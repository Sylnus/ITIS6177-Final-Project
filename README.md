# ITIS6177-Final-Project

# Azure AI Vision API

Welcome to the Image Analyzer API! 

This API was created to connect to the Microsoft Azure AI Vision API and provide its tagging and image caption services. This API will allow you to setup a connection to the Azure  API as well as a front-end webpage that will allow users to submit a URL to an online image or upload an image manually.
The goal of this API is to provide users with the Azure AI Vision services without requiring authentication or configuration for the Microsoft Service.
# Hosting
This API will be hosted through Digital Ocean services and we will be using SSH to configure the API files and host it online. Digital Ocean offers a variety of Operating Systems to the user but in this API we used Ubuntu Version 23.10 x64. After choosing your prefered OS you will need to select the configurations for your system. For general purpose you can select the Basic Shared CPU and regular SSD size. After that you can select the power of your CPU, SSD and transfer rate. This will depend on the size and ambition of your project but be aware that you can always expand your droplet afterwards and increase its performance and size. For the basic API project you can choose the option with 1 GB/1 CPU, 25 GB SSD and 1000 GB transfer.
### Hosting Authentication
In order to setup our hosting service and operating system you will need to provide Digital Ocean with an authentication method. This can be done through two methods:

**1. SSH Key**
   
   If you choose the SSH key method you will have to paste your generated SSH key into Digital Ocean and save it for current and future machines.

   If you do not currently have an SSH key you can do the following create a key on Linux, MacOS or Windows:

  * Open a terminal and run the following command: ```ssh-keygen```
  * You will recieve some dialogue to save and name the key. Please enter the file name you would like to save it as. You can also save it as default.
  * Now create a password for the key, it is highly recommended you do this for proper authentication measures. Afterwards enter the password again to confirm it.
  * Once your key is generated by default it should be named ```id_rsa``` and ```id_rsa.pub```
  * Copy the SSH key content by running the following command: ```cat ~/.ssh/id_rsa.pub```
  * Paste the content into the Public SSH Key box in Digital Ocean to save it.
   
**2. Password Setup**

If you are uncomfortable working with SSH key you can choose to connect to the droplet as the root user via a password. Select this option to create a root password. Please make sure to follow the following password  requirements:

  * Must be at least 8 characters long
  * Must contain 1 uppercase letter (cannot be first or last character)
  * Must contain 1 number
  * Cannot end in a number or special character

# Azure AI Vision Setup

Before we configure our personal API we are going to setup the Microsoft service API to make sure it is working and online for when we have to test our API connection. In order to setup our API service you will need to have or create a Microsoft Azure service account through ```https://portal.azure.com/#home```

Students are able to sign up using their university account as well as work accounts if they provide access to Microsoft Azure services. Once you are logged in/signed up head over to the Azure AI Services and click the ```Create``` button on Computer Vision. This will be the API we are using for our project. Follow the instructions provided by Microsoft to setup your subscription, pricing tier, region and any additional information. For our basic project you can use the free pricing tier is it is available for your subscription. This will allow you to use all the API features without incuring a cost.Continue the setup process and configure network access depending on who you want to give access to. Finally review and create your service.
Once your Computer Vision resource is setup, open the service for it to the Overview page. On this page take note of the Key and endpoint. We will be using those in our API code.

!!!

**The key is used to access Azure AI service API so do not share it with anyone!**

!!!

### Demo Testing

Above the Keys and endpoint section you will see a ```Get Started``` section. Click on that to go to the Vision Studio.

Our API is going to be setup to add captions to images. Click on the Try it out button under the card ```Add captions to images```
Check the box for ackowledgement and approving usage to your projects API resource when testing the demo. Here users will have an option to test out the API they will be using and connecting to. Click on one of the sample images above to see the tags and caption generated for the image. Users can also upload an image and have the demo create tags and captions for that image.

Scroll down to the bottom of the page to see additional resources for the API such as a Quickstart guide created by Microsoft that covers multiple programming languages such as C#, Python, Java, C++ and REST API.

# API Creation

Now that we have setup the Azure API we will get started on creating our personal API that will connect to the Azure API.

The goal of our API is to create a back-end application for users that will allow them to use the Azure API services without needing to setup the services or configure them. We will also be setting up a front-end webpage for users and hosting it on our Digital Ocean service so that users are able to have an interface to connect with instead of using Postman only.

## Setup

Windows Digital Ocean SSH Setup:

Download **Full** Cmder tool from: ```https://cmder.app/```

* Open up Cmder and run ```ssh root@ip_addrss_of_your_droplet```
* You will get a prompt about the key not being known by any other name, just type ```yes``` and hit enter
* You will get a prompt to enter the passphrase you created when setting up your SSH key, please enter that
* If successful, you will recieve a welcome message from Ubuntu with the version number

Windows Digital Ocean password Setup:

Download **Full** Cmder tool from: ```https://cmder.app/```

* Open up Cmder and run ```ssh root@ip_addrss_of_your_droplet```
* You will get a prompt about the key not being known by any other name, just type ```yes``` and hit enter
* You will get a prompt to enter the passphrase you created when setting up your Digital Ocean droplet, please enter that
* If successful, you will recieve a welcome message from Ubuntu with the version number

## Ubuntu Setup

Now that we have setup our Digital Ocean droplet and are connected to it we have to ready our Ubuntu system and install some prerequisite packages.

* In Cmder run the following command: ```sudo apt update``` This command will update the local packages for our Ubuntu system.
* Run the command: ```sudo apt install nodejs``` If any prompt comes up type ```Y``` and hit enter.Since our API is going to be written in Javascript we need to install Node.JS for our serverside code
* Run the command: ```sudo apt install npm``` If any prompt comes up type ```Y``` and hit enter. This might take a while to extract and install. Once you are given a prompt for which service should be restarted just hit ```Enter```. Since our API is going to use Javascript we need the npm tool to install packages required to run our code
* Run the command: ```sudo npm install -g pm2```. PM2 is a very useful process manager for our Node.js application which will allow us to keep our instance online even when the terminal is closed, monitor our files, log events and automatically restart our service if it crashes.

If you want to confirm the package is installed and the version number of the package you can run the following commands:
* ```node -v```
* ```npm -v```
* ```pm2 -v```
* ```pm2 list``` - This will list the running processes that are using pm2
* ```pm2 logs``` - This will check logs for pm2 managed services. Use ```Ctrl+C``` to exit.

## API Directory Setup

In this section we will setup our working directory for the project where ```app.js``` and ```index.html``` will be located. We will also install some additional packages in our working directory that will be required to run the app.

Run the following commands:
* ```mkdir API``` - This will create a new folder on our system for the API. You can name it what you want if you dont want to call it API
* ```ls -l``` - Run this command to het a list of directories to confirm the folder you just ran the  command for was created
* ```cd /root/API``` - We do this to switch our current working directory to the folder we just created
* ```npm install express``` - Package used for routing and building web apps and API
* ```npm install cors``` - Package used to allow a server to indicate any origins other than its own from which a browser should permit loading resources
* ```npm install axios``` - Package used to make API requests
* ```npm install multer``` - Package used for our file upload feature

Confirm the packages have been installed by running ```ls -l```. You should see 3 files/folders listed: ```node_module```, ```package-lock.json```, and ```package.json```

## API Creation

Now we will create the core file for our API, ```app.js```
In order to create the file you have to run ```nano app.js``` This will open up the text editor on Cmder. You can choose to write your code through this or use an external source such as Visual Studio Code(reccomended).

A template code is posted above. In order to connect to the Azure API this is where you will need to know the endpoint as well as your API key for proper authentication.

## Webpage Creation

## Errors
